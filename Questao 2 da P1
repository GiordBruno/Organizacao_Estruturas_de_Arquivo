#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#pragma pack(1)
struct registro{
    char chave[8];
    char nome[40];
    char email[40];
    char telefone[12];
};
int terminarCom(char *a,char *b){
	if(strncmp(a,b,40)==0)
		return 1;
	return 0;	
}
int main(){
 struct registro r[8] = {{"10","Armando","gmail.com","147"},
                         {"11","Eni","yahoo.com.br","258"},
                         {"12","Elias","uol.com.br","369"},
                         {"13","Luzia","uol.com.br","147"},
                         {"14","Pedro","gmail.com","369"},
						             {"15","Rena","yahoo.com.br","147"},
                         {"16","Eunice","uol.com.br","369"},
                         {"17","Rodrigo","gmail.com","258"}};
 struct registro cad;
 int i,qt,cont; 
 printf("Tamanho da estrutura %d\n\n",sizeof(struct registro));
 int primeiro,meio,ultimo,posicao;                       
 FILE *a,*saida;
 /*Abrindo o arquivo para escrita*/
 a=fopen("arq1.dat","wb");
 fwrite(&r,sizeof(struct registro),8,a);
 /*Fechando o arquivo*/
 fclose(a);
 /*Abrindo o arquivo'a'para leitura e o arquivo 'saida' para escrita*/
 a = fopen("arq1.dat","rb");
 saida = fopen("arq2.dat","wb");
 /*calculando tamanho do registro em byte e em quantidade de registros*/
 fseek(a,0,SEEK_END);
 printf("Tamanho do arquivo 'arq1' em bytes %ld\n",ftell(a));
 printf("Quantidade de registros no arquivo 'arq1' %ld\n\n",ftell(a)/sizeof(struct registro));
 ultimo = (ftell(a)/sizeof(struct registro))-1;
 /*Lendo o arquivo 'a' do ultimo registro para o primeiro e escrendo no arquivo 'saida'.*/ 
 rewind(a);
 qt = fread(&cad,sizeof(struct registro),1,a);
 while(qt>0){
 	if(terminarCom("gmail.com",cad.email)){
 		 fwrite(&cad,sizeof(struct registro),1,saida);
		 printf("Nome %.10s\n",cad.nome);
	 }
	 qt = fread(&cad,sizeof(struct registro),1,a);
	cont++;
 }
printf("Loops %d\n\n",cont);
 fclose(a);
 fclose(saida);
 return 0;                   
}
